<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>

<script>

function deg2rad(deg) {return deg * Math.PI/180;}

var lastcheck = new Date("2000-01-01");
var delay = 20;
var punished = false;

function distance (lon, lat) {
  var a =
    Math.pow(Math.sin((1.018349 - lat)/2), 2) +
    Math.cos(lat) * Math.cos(1.018349) *
    Math.pow(Math.sin((0.466143 - lon)/2), 2);
  return 11944 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function display (lon, lat) {

  if (new Date() - lastcheck < delay*1000) {
    delay += 5;
    punished = true;
  } else {
    var d = distance(lon, lat);
    var unit = d > 1 ? (''+parseFloat(d.toPrecision(2))).replace('.',',')+' versta ' : (''+parseFloat((500*d).toPrecision(2))).replace('.',',') + ' sülla ';
    document.getElementById('answer').innerHTML='&emsp;See punkt asub õigest kohast '+unit+'kaugusel.';
    lastcheck = new Date();
    if (delay > 15) {delay -= 10;}
  }
}

function updatedelay() {
  if (new Date() - lastcheck > delay*1000 || !punished) {
    document.getElementById('delay').innerHTML='';
    punished = false;
  } else {
    document.getElementById('delay').innerHTML='&emsp;<i>Brute-force</i> pole ju nii lõbus... oota veel '+ Math.round((new Date(lastcheck.getTime()+delay*1000)-new Date())/1000)+' s.';
  }
}

setInterval(updatedelay, 100);

</script>

</head>

<body style="max-width:1060px; padding:10px; margin:0 auto; font-family: Arial, Helvetica, sans-serif; font-size: 15px";>

<h2>Tere, Sander!</h2>

Sind ootab sünnipäeva puhul üks aardekirst :) Selle asukoha saad leida kahe infokillu põhjal.
<ul>
<li>Kui Tartu Tähetorni meridiaaniringi juures on astronoomiline keskpäev täpselt kell 12, siis otsitavas kohas leiab see aset kell 12.00.03,25.</li>
<li>Fr. G. W. Struve mõõtis Tartu Tähetornis 1837. aastal esimese inimesena ühe taevatähe kauguse meie Päikesesüsteemist. Eesti astronoomiapatrioodid kutsuvad seda hästituntud sinakas-valget tähte Struve ajaloolise mõõtmise auks „Tartu täheks“. Sinu sünnipäeva varahommikul kella kolmveerand viie paiku ületab see täht otsitavas kohas lõunapoolse meridiaani 70,4366° kõrgusel horisondist.</li>
</ul>

<h2>Aarde asukoha kontroll:</h2>
&emsp;<input type="number" id="lon" min="0" max="360" value="0" step=".0001" required>°E<br>
&emsp;<input type="number" id="lat" min="-90" max="90" value="0" step=".0001" required>°N<br>
&emsp;<button type="button" onclick="display(deg2rad(Number(document.getElementById('lon').value)), deg2rad(Number(document.getElementById('lat').value)))">Kontrolli</button><br><br>
<div id="answer"> </div>
<div id="delay"> </div>

</body>

</html>
